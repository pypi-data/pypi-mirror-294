
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gallery/plot_full_workflow.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gallery_plot_full_workflow.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_plot_full_workflow.py:


Simulating and Analyzing Flow Cytometer Signals
===============================================

This script demonstrates how to simulate flow cytometer signals using the `FlowCytometer` class
and analyze the results using the `PulseAnalyzer` class from the `FlowCyPy` library.

Flow cytometers measure forward scatter (FSC) and side scatter (SSC) signals when particles pass through a laser beam,
providing information about particle size, complexity, and other characteristics.

Steps in this Workflow:
-----------------------
1. Define a particle size distribution using `ScattererDistribution`.
2. Simulate flow cytometer signals using `FlowCytometer`.
3. Analyze the forward scatter signal with `PulseAnalyzer` to extract features like peak height, width, and area.
4. Visualize the generated signals and display the extracted pulse features.

.. GENERATED FROM PYTHON SOURCE LINES 18-114



.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /gallery/images/sphx_glr_plot_full_workflow_001.png
         :alt: Detector: first detector, Size Distribution of Scatterers (Normal Distribution)
         :srcset: /gallery/images/sphx_glr_plot_full_workflow_001.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /gallery/images/sphx_glr_plot_full_workflow_002.png
         :alt: Pulse Analysis
         :srcset: /gallery/images/sphx_glr_plot_full_workflow_002.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Scatterers Properties

    Flow Properties
    +-----------------------+-----------------------+
    | Property              | Value                 |
    +=======================+=======================+
    | Flow Speed            | 80.00 µm/s            |
    +-----------------------+-----------------------+
    | Flow Area             | 1.00 mm²              |
    +-----------------------+-----------------------+
    | Total Simulation Time | 1.00 s                |
    +-----------------------+-----------------------+
    | Mean Flow Rate        | 1.00 µm/s             |
    +-----------------------+-----------------------+
    | Std Flow Rate         | 200.00 nm/s           |
    +-----------------------+-----------------------+
    | Scatterer Density     | 1.00×10⁰ Tparticle/m³ |
    +-----------------------+-----------------------+
    | Number of events      | 8.00×10¹ particle     |
    +-----------------------+-----------------------+

    Scatterers Properties
    +-------------------------+-----------+
    | Property                | Value     |
    +=========================+===========+
    | Mean size               | 10.00 µm  |
    +-------------------------+-----------+
    | Size standard deviation | 800.00 nm |
    +-------------------------+-----------+

    FlowCytometer Properties

    Source Properties
    +---------------+-------------+
    | Property      | Value       |
    +===============+=============+
    | Optical Power | 200.00 mW   |
    +---------------+-------------+
    | Wavelength    | 1.55×10⁰ µm |
    +---------------+-------------+

    Detector [first detector] Properties
    +-------------------------------+------------+
    | Property                      | Value      |
    +===============================+============+
    | Acquisition Frequency         | 10.00 kHz  |
    +-------------------------------+------------+
    | Noise Level                   | 0.01 volt  |
    +-------------------------------+------------+
    | Baseline Shift Amplitude      | 0.01 volt  |
    +-------------------------------+------------+
    | Saturation Level              | 1e+30 volt |
    +-------------------------------+------------+
    | Number of Discretization Bins | 1024       |
    +-------------------------------+------------+

    Number of detected peaks: 11
    +--------+-------------+-------------+-------------+---------------+
    |   Peak | Time [s]    | Height      | Width       | Area          |
    +========+=============+=============+=============+===============+
    |      1 | 4.80×10⁰ ms | 3.96×10² kV | 7.30×10⁰ ms | 2.84×10⁰ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |      2 | 1.26×10² ms | 1.47×10⁰ MV | 5.72×10¹ ms | 6.71×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |      3 | 2.25×10² ms | 7.78×10² kV | 2.90×10¹ ms | 2.09×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |      4 | 2.93×10² ms | 8.16×10² kV | 2.46×10¹ ms | 1.89×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |      5 | 3.44×10² ms | 7.03×10² kV | 2.55×10¹ ms | 1.73×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |      6 | 4.15×10² ms | 1.96×10⁰ MV | 4.76×10¹ ms | 7.72×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |      7 | 5.12×10² ms | 1.28×10⁰ MV | 7.48×10¹ ms | 8.01×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |      8 | 5.98×10² ms | 9.77×10² kV | 2.19×10¹ ms | 2.04×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |      9 | 6.81×10² ms | 1.00×10⁰ MV | 3.53×10¹ ms | 3.27×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |     10 | 7.90×10² ms | 1.15×10⁰ MV | 1.62×10¹ ms | 1.81×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+
    |     11 | 8.37×10² ms | 1.95×10⁰ MV | 3.94×10¹ ms | 6.47×10¹ kV·s |
    +--------+-------------+-------------+-------------+---------------+

    '\nSummary:\n--------\nThis script simulates flow cytometer signals, processes them to detect peaks in the forward scatter channel,\nand extracts important features. The process is visualized through signal plots, and key properties are displayed.\n'





|

.. code-block:: python3


    # Step 1: Import necessary modules from FlowCyPy
    from FlowCyPy import FlowCytometer, ScattererDistribution, PulseAnalyzer, Detector, Source, Flow

    # Example usage of the Flow class
    flow = Flow(
        flow_speed=80e-6,  # 80 micrometers per second
        flow_area=1e-6,  # 1 square micrometer
        total_time=1.0,  # 1 second of flow
        mean_flow_rate=1e-6,  # 1 micrometer per second
        std_flow_rate=0.2e-6,  # 0.2 micrometers per second standard deviation
        scatterer_density=1e12  # 1e12 particles per cubic meter
    )

    # Step 2: Define the particle size distribution
    # ---------------------------------------------
    # Using a normal size distribution with a mean of 10 µm and a standard deviation of 0.8 µm.
    # This defines the scatterers (particles) that will interact with the laser source.
    scatterer_distribution = ScattererDistribution(
        flow=flow,
        refractive_index=1.5,        # Refractive index of the particles
        mean_size=10e-6,             # Mean particle size: 10 µm
        std_size=8e-7,               # Standard deviation: 0.8 µm
        distribution_type='normal'   # Normal distribution
    )

    # Step 3: Define the light source
    # -------------------------------
    # Define a laser source that illuminates the particles. The wavelength and power of the laser are crucial
    # for determining how the particles scatter light (e.g., Rayleigh scattering is wavelength-dependent).
    source = Source(
        numerical_aperture=0.4,      # Numerical aperture of the focusing optics
        wavelength=1550e-9,          # Wavelength of the laser source: 1550 nm
        optical_power=200e-3,        # Optical power of the laser source: 200 milliwatt
    )

    # Step 4: Define the detector
    # ---------------------------
    # A detector is used to measure the scattered light. The detector's numerical aperture and responsitivity
    # affect how much light it collects and converts to an electrical signal.
    detector = Detector(
        theta_angle=0,               # Angle of the detector relative to the incident light beam
        numerical_aperture=0.4,      # Numerical aperture of the detector optics
        name='first detector',       # Name or identifier for this detector
        responsitivity=1,            # Responsitivity of the detector (efficiency of detecting scattered light)
        acquisition_frequency=1e4,   # Sampling frequency: 10,000 Hz
        noise_level=1e-2,            # Signal noise level: 1 millivolt
        baseline_shift=0.01,         # Baseline shift of the detector output
        saturation_level=1e30,       # Saturation level of the detector signal
        n_bins=1024                  # Discretization bins for digitizing the signal
    )

    # Step 5: Simulate Flow Cytometer Signals
    # ---------------------------------------
    # Create a FlowCytometer instance to simulate forward and side scatter (FSC/SSC) signals.
    # The source, particle size distribution, and detector are passed in as parameters.
    cytometer = FlowCytometer(
        coupling_mechanism='rayleigh',    # Use Rayleigh scattering for small particles
        source=source,                    # Laser source defined above
        scatterer_distribution=scatterer_distribution,  # Particle size distribution defined above
        detectors=[detector]              # List of detectors used in the simulation (only one here)
    )

    # Simulate the pulse signals generated as particles pass through the laser beam.
    cytometer.simulate_pulse()

    # Display the properties of the simulated cytometer, including laser power, flow speed, etc.
    cytometer.print_properties()

    # Visualize the simulated signals for FSC/SSC channels.
    cytometer.plot()

    # Step 6: Analyze the Simulated FSC Signal
    # ----------------------------------------
    # Create a PulseAnalyzer instance to analyze the forward scatter (FSC) signal from the detector.
    # The analysis extracts features such as peak height, width, and area from the FSC signal.
    analyzer = PulseAnalyzer(
        detector=detector,            # Analyze the signal from the defined detector
        height_threshold=None         # Threshold for detecting peaks (None means auto-detect)
    )

    # Run the analysis to detect and measure pulse features.
    analyzer.run()

    # Visualize the detected peaks in the signal.
    analyzer.plot()

    # Display the extracted peak features such as height, width, and area.
    analyzer.display_features()

    """
    Summary:
    --------
    This script simulates flow cytometer signals, processes them to detect peaks in the forward scatter channel,
    and extracts important features. The process is visualized through signal plots, and key properties are displayed.
    """


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.466 seconds)


.. _sphx_glr_download_gallery_plot_full_workflow.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_full_workflow.py <plot_full_workflow.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_full_workflow.ipynb <plot_full_workflow.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
