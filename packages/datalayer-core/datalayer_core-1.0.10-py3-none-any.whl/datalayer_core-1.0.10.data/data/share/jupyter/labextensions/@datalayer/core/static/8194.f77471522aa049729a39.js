"use strict";(self.webpackChunk_datalayer_core=self.webpackChunk_datalayer_core||[]).push([[8194],{58194:(e,t,o)=>{o.r(t),o.d(t,{DocumentEdit:()=>m,default:()=>h});var s=o(74512),n=o(66029),r=o(99608),a=o(40809),i=o(23189),c=o(15738),l=o(43712),d=o(42799),u=o(37983);const m=()=>{const{documentId:e}=(0,r.UO)();if(!e)return(0,s.jsx)(s.Fragment,{});const t=(0,l.aF)(),o=(0,d.qX)(),m=((0,d.Ae)(),o.layout().space),{editor:h}=(0,c.of)(),{cloneDocument:p,getDocument:x,refreshDocument:f,updateDocument:y,updateDocumentModel:j}=(0,l.YT)(),{enqueueToast:v}=(0,l.pm)(),g=(0,a.useConfirm)(),k=(0,l.s0)(),B=o.document().documentSaveRequest,[C,b]=(0,n.useState)("document"),[S,T]=(0,n.useState)(),[D,F]=(0,n.useState)({name:"",description:""}),[E,w]=(0,n.useState)({name:void 0,description:void 0}),N=(e,t)=>{t.preventDefault(),o.layout().resetRightPortal(),"properties"===e&&I(),b(e)};(0,n.useEffect)((()=>{if(h&&S&&S.model){const e=h.parseEditorState(S.model);h.setEditorState(e),h.focus((()=>{}),{defaultSelection:"rootStart"})}}),[e,S,h]),(0,n.useEffect)((()=>("properties"!==C&&(o.layout().showBackdrop(),f(e).then((t=>{if(t.success){const t=x(e);t?(T(t),o.layout().setItem(t),F({name:t.name,description:t.description})):k("/")}})).finally((()=>{o.layout().hideBackdrop()}))),()=>{T(void 0),o.layout().setItem(void 0)})),[e]);const I=()=>{h&&S&&(T({...S,model:h.getEditorState().toJSON()}),o.layout().showBackdrop("Saving the document..."),j(e,h.getEditorState().toJSON()).then((e=>{e.success&&v("The document is successfully updated.",{variant:"success"})})).finally((()=>{o.layout().hideBackdrop()})))};(0,n.useEffect)((()=>{B&&S&&I()}),[B]),(0,n.useEffect)((()=>{w({...E,name:void 0===D.name?void 0:D.name.length>2,description:void 0===D.description?void 0:D.description.length>2})}),[D]);const L=(0,n.useCallback)((async s=>{g({title:"Are you sure?",content:"Please confirm you want to clone this document in your private library."}).then((s=>{s&&(o.layout().showBackdrop(),p(e).then((e=>{o.layout().hideBackdrop(),e.success&&(v(e.message,{variant:"success"}),o.layout().triggerItemsRefresh(),k(`/${t.handle}/library/documents`))})).finally((()=>{o.layout().hideBackdrop()})))}))}),[g,S]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.Pagehead,{children:(0,s.jsxs)(a.Box,{display:"flex",children:[(0,s.jsx)(a.Box,{flex:1,children:(0,s.jsx)(a.Heading,{sx:{fontSize:3},children:"Document editor"})}),"properties"!==C&&(0,s.jsx)(a.Box,{children:(0,s.jsx)(u.E7,{})}),S&&m&&(0,s.jsx)(a.Box,{ml:3,children:(0,s.jsx)(a.Button,{variant:"invisible",size:"small",leadingVisual:i.jcu,onClick:L,children:"Clone"})})]})}),S&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a.TabNav,{sx:{mt:3,mb:3},children:[(0,s.jsx)(a.TabNav.Link,{href:"",selected:"document"===C,onClick:e=>N("document",e),children:"Document"}),(0,s.jsx)(a.TabNav.Link,{href:"",selected:"properties"===C,onClick:e=>N("properties",e),children:"Properties"})]}),"document"===C&&S.model&&(0,s.jsx)(a.Box,{children:(0,s.jsx)(c.yO,{})}),"properties"===C&&(0,s.jsx)(a.Box,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,s.jsx)(a.Box,{children:(0,s.jsxs)(a.Box,{sx:{label:{marginTop:2}},children:[(0,s.jsxs)(a.FormControl,{children:[(0,s.jsx)(a.FormControl.Label,{children:"Name"}),(0,s.jsx)(a.TextInput,{block:!0,value:D.name,onChange:e=>{F((t=>({...t,name:e.target.value})))}}),!1===E.name&&(0,s.jsx)(a.FormControl.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,s.jsxs)(a.FormControl,{children:[(0,s.jsx)(a.FormControl.Label,{children:"Description"}),(0,s.jsx)(a.Textarea,{block:!0,value:D.description,onChange:e=>{F((t=>({...t,description:e.target.value})))}}),!1===E.description&&(0,s.jsx)(a.FormControl.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,s.jsx)(a.FormControl,{children:(0,s.jsx)(a.Button,{variant:"primary",disabled:!E.name||!E.description,sx:{marginTop:2},onClick:async()=>{o.layout().showBackdrop(),y(e,D.name,D.description).then((e=>{e.success&&(v("The document is successfully updated.",{variant:"success"}),o.layout().triggerItemsRefresh(),T({...S,name:D.name,description:D.description}))})).finally((()=>{o.layout().hideBackdrop()}))},children:"Update document"})})]})})})]})]})},h=m}}]);