"use strict";(self.webpackChunk_datalayer_core=self.webpackChunk_datalayer_core||[]).push([[4682],{34682:(e,t,s)=>{s.r(t),s.d(t,{DocumentEdit:()=>g,default:()=>k});var n=s(4565),r=s(89456),a=s(17168),i=s(41237),o=s(36088),c=s(66578),d=s(83773),l=s(52333),u=s(64264),m=s(12784),h=s(25939),p=s(79146),f=s(34441),x=s(24384),y=s(91899),j=s(78584),v=s(16770);const g=()=>{const{documentId:e}=(0,a.UO)();if(!e)return(0,n.jsx)(n.Fragment,{});const t=(0,y.aF)(),s=(0,j.qX)(),g=((0,j.Ae)(),s.layout().space),{editor:k}=(0,x.of)(),{cloneDocument:Z,getDocument:S,refreshDocument:b,updateDocument:C,updateDocumentModel:D}=(0,y.YT)(),{enqueueToast:E}=(0,y.pm)(),B=(0,i.N)(),w=(0,y.s0)(),T=s.document().documentSaveRequest,[I,N]=(0,r.useState)("document"),[F,L]=(0,r.useState)(),[O,P]=(0,r.useState)({name:"",description:""}),[R,_]=(0,r.useState)({name:void 0,description:void 0}),q=(e,t)=>{t.preventDefault(),s.layout().resetRightPortal(),"properties"===e&&V(),N(e)};(0,r.useEffect)((()=>{if(k&&F&&F.model){const e=k.parseEditorState(F.model);k.setEditorState(e),k.focus((()=>{}),{defaultSelection:"rootStart"})}}),[e,F,k]),(0,r.useEffect)((()=>("properties"!==I&&(s.layout().showBackdrop(),b(e).then((t=>{if(t.success){const t=S(e);t?(L(t),s.layout().setItem(t),P({name:t.name,description:t.description})):w("/")}})).finally((()=>{s.layout().hideBackdrop()}))),()=>{L(void 0),s.layout().setItem(void 0)})),[e]);const V=()=>{k&&F&&(L({...F,model:k.getEditorState().toJSON()}),s.layout().showBackdrop("Saving the document..."),D(e,k.getEditorState().toJSON()).then((e=>{e.success&&E("The document is successfully updated.",{variant:"success"})})).finally((()=>{s.layout().hideBackdrop()})))};(0,r.useEffect)((()=>{T&&F&&V()}),[T]),(0,r.useEffect)((()=>{_({...R,name:void 0===O.name?void 0:O.name.length>2,description:void 0===O.description?void 0:O.description.length>2})}),[O]);const z=(0,r.useCallback)((async n=>{B({title:"Are you sure?",content:"Please confirm you want to clone this document in your private library."}).then((n=>{n&&(s.layout().showBackdrop(),Z(e).then((e=>{s.layout().hideBackdrop(),e.success&&(E(e.message,{variant:"success"}),s.layout().triggerItemsRefresh(),w(`/${t.handle}/library/documents`))})).finally((()=>{s.layout().hideBackdrop()})))}))}),[B,F]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Z,{children:(0,n.jsxs)(c.Z,{display:"flex",children:[(0,n.jsx)(c.Z,{flex:1,children:(0,n.jsx)(d.Z,{sx:{fontSize:3},children:"Document editor"})}),"properties"!==I&&(0,n.jsx)(c.Z,{children:(0,n.jsx)(v.E7,{})}),F&&g&&(0,n.jsx)(c.Z,{ml:3,children:(0,n.jsx)(l.r,{variant:"invisible",size:"small",leadingVisual:f.jcu,onClick:z,children:"Clone"})})]})}),F&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(u.Z,{sx:{mt:3,mb:3},children:[(0,n.jsx)(u.Z.Link,{href:"",selected:"document"===I,onClick:e=>q("document",e),children:"Document"}),(0,n.jsx)(u.Z.Link,{href:"",selected:"properties"===I,onClick:e=>q("properties",e),children:"Properties"})]}),"document"===I&&F.model&&(0,n.jsx)(c.Z,{children:(0,n.jsx)(x.yO,{})}),"properties"===I&&(0,n.jsx)(c.Z,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,n.jsx)(c.Z,{children:(0,n.jsxs)(c.Z,{sx:{label:{marginTop:2}},children:[(0,n.jsxs)(m.Z,{children:[(0,n.jsx)(m.Z.Label,{children:"Name"}),(0,n.jsx)(h.Z,{block:!0,value:O.name,onChange:e=>{P((t=>({...t,name:e.target.value})))}}),!1===R.name&&(0,n.jsx)(m.Z.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,n.jsxs)(m.Z,{children:[(0,n.jsx)(m.Z.Label,{children:"Description"}),(0,n.jsx)(p.ZP,{block:!0,value:O.description,onChange:e=>{P((t=>({...t,description:e.target.value})))}}),!1===R.description&&(0,n.jsx)(m.Z.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,n.jsx)(m.Z,{children:(0,n.jsx)(l.r,{variant:"primary",disabled:!R.name||!R.description,sx:{marginTop:2},onClick:async()=>{s.layout().showBackdrop(),C(e,O.name,O.description).then((e=>{e.success&&(E("The document is successfully updated.",{variant:"success"}),s.layout().triggerItemsRefresh(),L({...F,name:O.name,description:O.description}))})).finally((()=>{s.layout().hideBackdrop()}))},children:"Update document"})})]})})})]})]})},k=g}}]);