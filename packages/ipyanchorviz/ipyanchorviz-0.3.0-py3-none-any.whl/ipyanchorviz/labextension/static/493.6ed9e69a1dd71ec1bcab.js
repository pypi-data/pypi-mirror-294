"use strict";(self.webpackChunkipyanchorviz=self.webpackChunkipyanchorviz||[]).push([[493],{145:(e,t,n)=>{n.r(t),n.d(t,{AnchorVizModel:()=>m,AnchorVizView:()=>A,version:()=>y.rE});var o=n(801),i=n(42),r=n(440),a=n(549);function s(e,t,n,o=!1){let i=e.model.get("radius"),r=e.model.get("margin"),a=t*Math.cos(n),s=t*Math.sin(n);return o&&(a+=i+r.left,s+=i+r.top),[a,s]}function c(e,t,n){let o=e.model.get("radius"),i=e.model.get("margin");return[t-=o+i.left,n-=o+i.top]}function l(e,t,n){[t,n]=c(e,t,n);let o=Math.atan(n/t);return t<0&&(o+=Math.PI),o}function d(e,t){for(let n=0;n<t.length;n++)if(t[n].id===e)return n;return-1}function h(e,t){return-1!==d(e.id,t)}function u(e){if(0===e.length)return-1;let t=parseInt(e[0].id);for(let n of e)parseInt(n.id)>t&&(t=parseInt(n.id));return t}function g(e){return i.cloneDeep(e.model.get("anchors"))}function v(e,t){e.model.set("anchors",i.cloneDeep(t)),e.touch(),e.localAnchors=i.cloneDeep(t)}function f(e){e.enterDatapoints(),e.animateDatapoints()}function p(e){let t,n=e.model.get("radius"),o=e.model.get("margin"),h=e.model.get("focusIndicatorActionDistance"),f=e.model.get("anchorSize");e.defaultAnchorColor="grey",e.focusIndicatorActionInRange=!1,e.focusIndicatorOverAnchor=!1,e.anchorDragging=!1,e.hoveringOverPoint=!1,e.draggingAnchorPrevTheta=0;let p=function(t){let n=e.localAnchors,o=0,i=0,r=e.model.get("radius")-e.model.get("ringInnerPadding"),a=e.model.get("autoNorm");if(void 0!==t.weights){function l(e){return void 0===e.visible||e.visible}for(let d of n)if(l(d)){if(d.id in t.weights){let h=t.weights[d.id],[u,g]=s(e,r,d.theta,!1);o+=u*h,i+=g*h}}else if(t.weights[d.id]>0){a=!0;break}if(a){o=0,i=0;let v=0;for(let f of n)l(f)&&f.id in t.weights&&(v+=t.weights[f.id]);if(v>0)for(let p of n)if(l(p)&&p.id in t.weights){let m=t.weights[p.id]/v,[A,y]=s(e,r,p.theta,!1);o+=A*m,i+=y*m}}}let c=e.getNoise(e,t);return o+=c[0],i+=c[1],[o,i]},m=function(){let[o,i]=r.mouse(e.overlay.node()),a=function(e,t,n){return[t,n]=c(e,t,n),Math.sqrt(t*t+n*n)}(e,o,i),d=Math.abs(a-n);e.focusIndicatorActionInRange=d<h,t.classed("ring-focus-indicator-action-possible",e.focusIndicatorActionInRange);let u=l(e,o,i),g=s(e,n,u,!0);t.attr("transform",`translate(${g[0]}, ${g[1]})`)};function A(){e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint||e.lasso.items().classed("within-current-lasso-selection",!1).classed("lassoed-point",!1)}function y(){e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint||(e.lasso.possibleItems().classed("within-current-lasso-selection",!0),e.lasso.notPossibleItems().classed("within-current-lasso-selection",!1))}function I(){if(e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint)return;e.lasso.items().classed("within-current-lasso-selection",!1);let t=[];e.lasso.selectedItems().each((e=>{t=[...t,e.id]})),e.model.set("lassoedPointIDs",t),e.touch(),e.model.send({type:"lasso_change",pointIDs:t})}e.addVizAnchor=function(n){e.localAnchors.push(i.cloneDeep(n)),e.svg.append("circle").attr("id","anchor-"+n.id.toString()).classed("anchor",!0).attr("r",f).on("mouseover",(()=>t.classed("ring-focus-indicator-anchor-hover",!0))).on("mouseout",(()=>t.classed("ring-focus-indicator-anchor-hover",!1))).on("mousemove",(()=>e.overlay.node().dispatchEvent(new MouseEvent(r.event.type,r.event)))).on("click",(()=>{let t=e.model.get("selectedAnchorID");""!=t&&e.svg.select("#anchor-"+t).classed("anchor-selected",!1),t=n.id,e.svg.select("#anchor-"+t).classed("anchor-selected",!0),e.model.set("selectedAnchorID",t),e.touch()})).call(r.drag().on("start",(()=>{return o=n,e.anchorDragging=!0,e.draggingAnchorPrevTheta=o.theta,e.svg.select("#anchor-"+o.id.toString()).classed("anchor-dragging",!0),void t.classed("ring-focus-indicator-active",!0);var o})).on("drag",(()=>function(t){let n=r.mouse(e.overlay.node()),o=l(e,n[0],n[1]);t.theta=o,e.localAnchors[d(t.id,e.localAnchors)].theta=o,e.updateAnchorDisplayPos(t),e.updateDataPointPositionsImmediate(),m()}(n))).on("end",(()=>function(n){e.anchorDragging=!1;let o=g(e);(function(e,t){for(let n of t)if(n.id===e)return n;return null}(n.id,o)).theta=n.theta,e.svg.select("#anchor-"+n.id.toString()).classed("anchor-dragging",!1),t.classed("ring-focus-indicator-active",!1),n.theta!==e.draggingAnchorPrevTheta&&(v(e,o),e.model.send({type:"anchor_drag",theta:n.theta,id:n.id}))}(n)))),e.svg.append("text").classed("anchor-label",!0).attr("id","anchor-text-"+n.id.toString()),e.updateVizAnchorAttrs(n),e.updateAnchorDisplayPos(n)},e.updateVizAnchorAttrs=function(t){let n=e.svg.select("#anchor-"+t.id.toString()),o=e.svg.select("#anchor-text-"+t.id.toString());void 0!==t.color?n.style("fill",t.color):n.style("fill",null),o.text(t.name)},e.updateAnchorDisplayPos=function(t){n=e.model.get("radius");let o=s(e,n,t.theta,!0),i=s(e,n+h,t.theta,!0),r=e.svg.select("#anchor-"+t.id.toString()),a=e.svg.select("#anchor-text-"+t.id.toString());var c;r.attr("cx",o[0]).attr("cy",o[1]),a.attr("x",i[0]).attr("y",i[1]).attr("text-anchor",(c=t.theta)>Math.PI/4&&c<3*Math.PI/4||c>5*Math.PI/4&&c<7*Math.PI/4?"middle":c<Math.PI/4||c>7*Math.PI/4?"start":c<5*Math.PI/4&&c>3*Math.PI/4?"end":"ERROR")},e.updateDataPointPositionsImmediate=function(){n=e.model.get("radius"),o=e.model.get("margin"),e.svg.selectAll(".datapoint").attr("cx",(e=>p(e)[0]+n+o.left)).attr("cy",(e=>p(e)[1]+n+o.top))},e.getNoise=function(e,t){if(void 0===e.noise&&(e.noise={}),t.id in e.noise)return e.noise[t.id];let n=e.model.get("noiseMagnitude"),o=Math.random()*n-n/2,i=Math.random()*n-n/2;return e.noise[t.id]=[o,i],[o,i]},e.enterDatapoints=function(){let t=e.model.get("data"),n=e.model.get("radius"),o=e.model.get("margin"),i=e.model.get("pointSize"),s=e.svg.selectAll(".datapoint").data(t,(e=>e.id.toString()));s.enter().append("circle").classed("datapoint",!0).attr("cx",(function(){return n+o.left})).attr("cy",(function(){return n+o.top})).attr("r",i).attr("fill",(e=>void 0===e.color?"green":e.color)).classed("labeled-point",(e=>void 0!==e.labeled&&e.labeled)).on("mouseover",(t=>{e.model.set("selectedDataPointID",t.id.toString()),e.touch(),e.model.send({type:"point_hover",pointID:t.id})})).on("mousemove",(()=>e.overlay.node().dispatchEvent(new MouseEvent(r.event.type,r.event)))),s.exit().remove(),function(){let t=e.model.get("data"),n=e.svg.selectAll(".datapoint").data(t);e.lasso=a.lasso().closePathSelect(!0).closePathDistance(100).items(n).targetArea(e.svg).on("start",A).on("draw",y).on("end",I),e.svg.call(e.lasso)}()},e.animateDatapoints=function(){let t=e.model.get("radius"),n=e.model.get("margin"),o=e.model.get("data"),i=e.svg.selectAll(".datapoint").data(o,(e=>e.id.toString()));function r(e){return void 0===e.visible||e.visible}i.style("visibility","visible"),i.transition().duration(e.model.get("animationTime")).attr("cx",(e=>p(e)[0]+t+n.left)).attr("cy",(e=>p(e)[1]+t+n.top)).style("fill",(e=>e.color)).style("opacity",(e=>r(e)?1:0)).on("end",(()=>{this.svg.selectAll(".datapoint").style("visibility",(e=>r(e)?"visible":"hidden"))})),i.classed("labeled-point",(e=>void 0!==e.labeled&&e.labeled))},function(){e.localAnchors=[];let i=document.createElementNS("http://www.w3.org/2000/svg","svg");e.el.appendChild(i),e.el.setAttribute("class","jupyter-widget anchorviz"),e.width=2*n+o.left+o.right,e.height=2*n+o.top+o.bottom,e.svg=r.select(i),e.svg.attr("width",e.width).attr("height",e.height),e.ring=e.svg.append("circle").attr("class","ring").attr("r",n).attr("cx",n+o.left).attr("cy",n+o.top),t=e.svg.append("g").attr("class","ring-focus-indicator"),t.append("circle").attr("r",e.model.get("focusIndicatorSize")),e.overlay=e.svg.append("rect").attr("class","click-overlay").attr("width",e.width).attr("height",e.height).on("mousemove",m).on("click",(function(){!function(){if(e.focusIndicatorActionInRange){let[t,n]=r.mouse(e.overlay.node()),o=l(e,t,n),i=e.model.get("anchors"),a={id:(parseInt(u(i))+1).toString(),theta:o,name:"New Anchor"},s=[...i,a];v(e,s),e.model.send({type:"anchor_add",theta:o,newAnchor:a})}}()}));for(let t of g(e))e.addVizAnchor(t);e.enterDatapoints(),e.animateDatapoints()}()}n(460);class m extends o.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:"AnchorVizModel",_view_name:"AnchorVizView",_model_module:"ipyanchorviz",_view_module:"ipyanchorviz",_model_module_version:"0.3.0",_view_module_version:"0.3.0",anchors:[],selectedAnchorID:"",data:[],selectedDataPointID:"",lassoedPointIDs:[],margin:{left:80,right:80,top:30,bottom:30},radius:275,ringInnerPadding:35,anchorTextOffset:20,pointSize:2,anchorSize:6,focusIndicatorSize:8.5,focusIndicatorActionDistance:20,autoNorm:!1,noiseMagnitude:15,animationTime:2e3}}}class A extends o.DOMWidgetView{render(){p(this),this.model.on("change:anchors",this.anchorsChange,this),this.model.on("change:selectedAnchorID",this.selectedAnchorChange,this),this.model.on("change:data",this.dataChange,this),this.model.on("change:selectedDataPointID",this.selectedDataPointChange,this),this.model.on("change:lassoedPointIDs",this.lassoedPointsChange,this)}anchorsChange(){!function(e){let t=e.model.previous("anchors"),n=g(e),o=!1;for(let i of n)h(i,t)?(console.log("Updating "+i.id.toString()),e.updateVizAnchorAttrs(i),e.updateAnchorDisplayPos(i)):(o=!0,console.log("Adding from update "+i.id.toString()),e.addVizAnchor(i),f(e));let i=!1;for(let o of t)h(o,n)||(i=!0,console.log("Removing "+o.id.toString()),e.svg.select("#anchor-"+o.id.toString()).remove(),e.svg.select("#anchor-text-"+o.id.toString()).remove());e.localAnchors=n,i?(console.log("updating data"),f(e)):o||e.updateDataPointPositionsImmediate()}(this)}selectedAnchorChange(){var e;(e=this).svg.selectAll(".anchor").classed("anchor-selected",!1),e.svg.select("#anchor-"+e.model.get("selectedAnchorID").toString()).classed("anchor-selected",!0)}dataChange(){f(this)}selectedDataPointChange(){var e;(e=this).svg.selectAll(".datapoint").classed("selected-point",(t=>t.id===e.model.get("selectedDataPointID")))}lassoedPointsChange(){!function(e){let t=e.model.get("lassoedPointIDs");e.svg.selectAll(".datapoint").classed("lassoed-point",(e=>t.includes(e.id)))}(this)}}const y={rE:"0.3.0"}},493:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r,helloWidgetPlugin:()=>i});var o=n(145);const i={id:"ipyanchorviz:plugin",requires:[n(801).IJupyterWidgetRegistry],activate:function(e,t){t.registerWidget({name:"ipyanchorviz",version:o.version,exports:{AnchorVizModel:o.AnchorVizModel,AnchorVizView:o.AnchorVizView}})},autoStart:!0},r=i},687:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(601),i=n.n(o),r=n(314),a=n.n(r)()(i());a.push([e.id,".anchorviz .ring {\n    stroke: var(--ringColor, grey);\n    fill: var(--ringFill, #222222);\n}\n\n.anchorviz .click-overlay {\n    fill: none;\n    pointer-events: all;\n}\n\n.anchorviz .ring-focus-indicator circle {\n    stroke: var(--focusStroke, red);\n    fill: none;\n}\n\n.anchorviz .ring-focus-indicator-action-possible circle {\n    stroke: var(--focusStrokeActionPossible, #44DDFF) !important;\n}\n\n.anchorviz .ring-focus-indicator-anchor-hover circle {\n    stroke: var(--focusStrokeAnchorHover, #FFDD44) !important;\n}\n\n.anchorviz .ring-focus-indicator-active circle {\n    stroke: var(--anchorDraggingColor, #99FFAA) !important;\n}\n\n.anchorviz .anchor {\n    pointer-events: all;\n    fill: var(--defaultAnchorColor, grey);\n}\n\n.anchorviz .anchor-selected {\n    fill: var(--selectedAnchorColor, #99AAFF) !important;\n}\n.anchorviz .anchor-dragging {\n    fill: var(--anchorDraggingColor, #99FFAA) !important;\n}\n\n.anchorviz .anchor-label {\n    fill: var(--textColor, white);\n    font-size: 12px;\n    font-family: arial;\n}\n\n.anchorviz .labeled-point {\n    stroke: var(--labeledPointColor, #FFFFFF) !important;\n    stroke-width: 1px;\n}\n.anchorviz .lassoed-point {\n    stroke: var(--lassoedPointColor, #22AA22) !important;\n    stroke-width: 1px;\n}\n.anchorviz .selected-point {\n    stroke: var(--selectedPointColor, #FF0000) !important;\n}\n.anchorviz .within-current-lasso-selection {\n    stroke: var(--lassoingColor, green) !important;\n    stroke-width: 2px;\n}\n\n.anchorviz .lasso path {\n    stroke: rgb(80, 80, 80);\n    stroke-width: 2px;\n}\n.anchorviz .lasso .drawn {\n    fill-opacity: 0.05;\n}\n.anchorivz .lasso .loop_close {\n    fill: none;\n    stroke-dasharray: 4, 4;\n}\n",""]);const s=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);o&&a[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},601:e=>{e.exports=function(e){return e[1]}},460:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var o=n(72),i=n.n(o),r=n(825),a=n.n(r),s=n(659),c=n.n(s),l=n(56),d=n.n(l),h=n(540),u=n.n(h),g=n(113),v=n.n(g),f=n(687),p={};p.styleTagTransform=v(),p.setAttributes=d(),p.insert=c().bind(null,"head"),p.domAPI=a(),p.insertStyleElement=u(),i()(f.A,p);const m=f.A&&f.A.locals?f.A.locals:void 0},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},a=[],s=0;s<e.length;s++){var c=e[s],l=o.base?c[0]+o.base:c[0],d=r[l]||0,h="".concat(l," ").concat(d);r[l]=d+1;var u=n(h),g={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)t[u].references++,t[u].updater(g);else{var v=i(g,o);o.byIndex=s,t.splice(s,0,{identifier:h,updater:v,references:1})}a.push(h)}return a}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=o(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var s=n(r[a]);t[s].references--}for(var c=o(e,i),l=0;l<r.length;l++){var d=n(r[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}}]);