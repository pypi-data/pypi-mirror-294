"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5817],{31309:(e,t,a)=>{var n=a(29079),r=a(97440),s=a.n(r),l=a(14867),i=a.n(l),o=a(97598),c=a.n(o),u=a(86326),d=a(35623),m=a(87597),p=a(56237),E=a(47279),x=a(6841),y=a(54219),g=a(89152),b=a(96478),_=a(49528),f=a(24372),T=a(78434),A=a.n(T),h=a(79858),v=a(42430),D=a(6423),q=a(45423),O=a(53225);const w={personal_data:b.Translate.string("Basic information about your account"),settings:b.Translate.string("Your global Indico settings"),contribs:b.Translate.string("Data about your contributions in events"),note_revisions:b.Translate.string("Data about minutes you wrote in events"),registrations:b.Translate.string("Data you submitted when registering for events"),room_booking:b.Translate.string("Your rooms and reservations"),abstracts_papers:b.Translate.string("Data about your abstract and paper submissions"),survey_submissions:b.Translate.string("Your survey answers"),attachments:b.Translate.string("Data about materials you uploaded"),editables:b.Translate.string("Data about editables submitted through the Editing module"),misc:b.Translate.string("Other data such as your API tokens and OAuth applications")};function R({onSubmit:e,exportOptions:t}){return u.createElement(u.Fragment,null,u.createElement("p",{className:"users-client-js-___DataExportForm-module__form-description___aTX-6"},u.createElement(b.Translate,null,"Here, you can request to export all data concerning you that is currently stored in Indico.")),u.createElement(v.Form,{onSubmit:e,initialValues:{includeFiles:!1,options:{}},initialValuesEqual:A(),validate:({options:e})=>{if(!Object.values(e).some((e=>e)))return{[h.FORM_ERROR]:b.Translate.string("At least one option in the data section must be selected")}}},(e=>u.createElement(D.A,{onSubmit:e.handleSubmit},u.createElement(S,{exportOptions:t}),u.createElement(C,null),u.createElement("div",{className:"users-client-js-___DataExportForm-module__submit___Ncicq"},u.createElement(g.FinalSubmitButton,{label:b.Translate.string("Export my data")}))))))}function S({exportOptions:e}){return u.createElement(u.Fragment,null,u.createElement(q.A,{size:"medium",dividing:!0},u.createElement(b.Translate,{context:"user data export"},"Data selection")),u.createElement(O.A,null,e.map((([e,t])=>u.createElement(O.A.Item,{key:e},u.createElement(O.A.Content,null,u.createElement(k,{name:`options.${e}`,title:t,description:w[e]})))))))}function C(){return u.createElement(u.Fragment,null,u.createElement(q.A,{size:"medium",dividing:!0},u.createElement(b.Translate,{context:"user data export"},"Additional options")),u.createElement(O.A,null,u.createElement(O.A.Item,null,u.createElement(O.A.Content,null,u.createElement(k,{name:"includeFiles",title:b.Translate.string("Include files"),description:b.Translate.string("If checked, for each selected option, a copy of all your uploaded files will be included in the export. Note that depending on the number of files, this may significantly increase the download size of the export")})))))}function k({name:e,title:t,description:a}){return u.createElement("div",{className:"users-client-js-___DataExportForm-module__toggle___jslF4"},u.createElement(g.FinalCheckbox,{name:e,label:u.createElement("label",null,u.createElement("b",null,t))}),u.createElement("div",{className:"users-client-js-___DataExportForm-module__description___oPN3G"},a))}R.propTypes={onSubmit:c().func.isRequired,exportOptions:c().array.isRequired},S.propTypes={exportOptions:c().array.isRequired},k.propTypes={name:c().string.isRequired,title:c().string.isRequired,description:c().string.isRequired};const F=n.Ay.bind(null,{endpoint:"users.api_user_data_export",rules:[{args:["user_id"],converters:{user_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"data-export",isDynamic:!1}]},{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"data-export",isDynamic:!1}]}]},"/");function N({userId:e,request:t,exportOptions:a}){const n=null!==e?{user_id:e}:{},[r,l]=(0,u.useState)(t.state);return u.createElement("div",{className:"i-box-group vert"},u.createElement("div",{className:"i-box"},u.createElement("div",{className:"i-box-header"},u.createElement("div",{className:"i-box-title"},u.createElement(b.Translate,null,"Data export"))),u.createElement("div",{className:"i-box-content ui"},"none"===r&&u.createElement(R,{onSubmit:async e=>{const{includeFiles:t,options:a}=e,r=Object.keys(s()(a));let i;try{i=await _.indicoAxios.post(F(n),{include_files:t,options:r})}catch(e){return(0,g.handleSubmitError)(e)}l(i.data.state)},exportOptions:a}),"running"===r&&u.createElement(j,null),"success"===r&&u.createElement(I,{request:t,exportOptions:a,setState:l}),"failed"===r&&u.createElement(z,{setState:l}),"expired"===r&&u.createElement(H,{setState:l}))))}function j(){return u.createElement("div",null,u.createElement(m.A,{info:!0},u.createElement(m.A.Header,null,u.createElement(b.Translate,{context:"user data export"},"Your data is being prepared. We will notify you by email once it is available for download."))))}function I({request:e,exportOptions:t,setState:a}){return u.createElement("div",null,u.createElement("div",null,u.createElement(m.A,{positive:!0},u.createElement(m.A.Header,null,u.createElement(b.Translate,null,"Your data export is ready")),u.createElement(b.Translate,{as:"p",context:"user data export"},"You can download it from the link below")),e.maxSizeExceeded&&u.createElement(m.A,{warning:!0},u.createElement(b.Translate,{as:"p",context:"user data export"},"Some files were not exported due to exceeding the maximum allowed size of the archive. Consider selecting less options")),u.createElement(Y,{request:e,exportOptions:t}),u.createElement("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.5em"}},u.createElement(p.A,{onClick:()=>a("none")},u.createElement(b.Translate,{context:"user data export"},"New export")),u.createElement(p.A,{primary:!0,icon:!0,labelPosition:"right",as:"a",href:e.url},u.createElement(b.Translate,null,"Download"),u.createElement(E.A,{name:"download"})))))}function z({setState:e}){return u.createElement("div",null,u.createElement(m.A,{negative:!0},u.createElement(m.A.Header,null,u.createElement(b.Translate,{context:"user data export"},"Data export failed")),u.createElement(b.Translate,{as:"p",context:"user data export"},"You can request a new one")),u.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},u.createElement(p.A,{primary:!0,icon:!0,labelPosition:"right",onClick:()=>e("none")},u.createElement(b.Translate,null,"Retry"),u.createElement(E.A,{name:"redo"}))))}function H({setState:e}){return u.createElement("div",null,u.createElement(m.A,{warning:!0},u.createElement(m.A.Header,null,u.createElement(b.Translate,null,"Download link expired"))),u.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},u.createElement(p.A,{primary:!0,onClick:()=>e("none"),icon:!0,labelPosition:"right"},u.createElement(b.Translate,{context:"user data export"},"New export"),u.createElement(E.A,{name:"zip"}))))}function Y({request:e,exportOptions:t}){return u.createElement(x.A,{celled:!0},u.createElement(x.A.Header,null,u.createElement(x.A.Row,null,u.createElement(x.A.HeaderCell,null,u.createElement(b.Translate,{context:"user data export request date"},"Requested on")),u.createElement(x.A.HeaderCell,null,u.createElement(b.Translate,{context:"user data export"},"Contents")))),u.createElement(x.A.Body,null,u.createElement(x.A.Row,null,u.createElement(x.A.Cell,null,i()(e.requestedDt).format("L")),u.createElement(x.A.Cell,null,e.selectedOptions.map((e=>u.createElement(y.A,{className:"users-client-js-___DataExport-module__option-label___DWmGs",key:e},t.find((([t])=>t===e))[1])))))))}N.propTypes={userId:c().number,request:c().shape({state:c().string.isRequired,requestedDt:c().string,selectedOptions:c().array,maxSizeExceeded:c().bool,url:c().string}).isRequired,exportOptions:c().array.isRequired},N.defaultProps={userId:null},I.propTypes={request:c().object.isRequired,exportOptions:c().array.isRequired,setState:c().func.isRequired},z.propTypes={setState:c().func.isRequired},H.propTypes={setState:c().func.isRequired},Y.propTypes={request:c().shape({requestedDt:c().string.isRequired,selectedOptions:c().arrayOf(c().string).isRequired}).isRequired,exportOptions:c().array.isRequired},window.setupDataExport=function(e,t,a){document.addEventListener("DOMContentLoaded",(()=>{d.render(u.createElement(N,{userId:e,request:(0,f.camelizeKeys)(t),exportOptions:a}),document.querySelector("#data-export-container"))}))}}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=31309,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_users.data_export.cd7b056c.bundle.js.map