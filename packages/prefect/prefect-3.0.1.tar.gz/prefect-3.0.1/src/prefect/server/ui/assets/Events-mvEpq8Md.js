import{d as ee,i as q,af as te,an as ne,ao as K,ap as ae,aq as se,ar as re,as as oe,at as le,au as ie,av as ue,w as Q,m as n,c as V,j as S,a as P,a8 as H,k as F,aw as ce,ax as de,o as h,l as y,K as fe,n as L,ay as me,a6 as j,az as pe,aA as ge,aB as ve,aC as ye,z as X,x as _e,aD as be,F as De,aE as xe,aF as ke}from"./index-ADHdZRj7.js";import{g as Te,c as U}from"./_commonjsHelpers-Cpj98o6Y.js";import{u as Se}from"./usePageTitle-BizFWTzf.js";var je="Expected a function",J=NaN,Re="[object Symbol]",Ee=/^\s+|\s+$/g,Oe=/^[-+]0x[0-9a-f]+$/i,Ie=/^0b[01]+$/i,he=/^0o[0-7]+$/i,Be=parseInt,Ce=typeof U=="object"&&U&&U.Object===Object&&U,Ne=typeof self=="object"&&self&&self.Object===Object&&self,Ve=Ce||Ne||Function("return this")(),Fe=Object.prototype,Le=Fe.toString,Ue=Math.max,we=Math.min,W=function(){return Ve.Date.now()};function ze(e,o,u){var m,c,f,i,a,r,_=0,B=!1,b=!1,T=!0;if(typeof e!="function")throw new TypeError(je);o=Y(o)||0,$(u)&&(B=!!u.leading,b="maxWait"in u,f=b?Ue(Y(u.maxWait)||0,o):f,T="trailing"in u?!!u.trailing:T);function D(t){var d=m,p=c;return m=c=void 0,_=t,i=e.apply(p,d),i}function R(t){return _=t,a=setTimeout(x,o),B?D(t):i}function w(t){var d=t-r,p=t-_,g=o-d;return b?we(g,f-p):g}function E(t){var d=t-r,p=t-_;return r===void 0||d>=o||d<0||b&&p>=f}function x(){var t=W();if(E(t))return C(t);a=setTimeout(x,w(t))}function C(t){return a=void 0,T&&m?D(t):(m=c=void 0,i)}function z(){a!==void 0&&clearTimeout(a),_=0,m=r=c=a=void 0}function A(){return a===void 0?i:C(W())}function O(){var t=W(),d=E(t);if(m=arguments,c=this,r=t,d){if(a===void 0)return R(r);if(b)return a=setTimeout(x,o),D(r)}return a===void 0&&(a=setTimeout(x,o)),i}return O.cancel=z,O.flush=A,O}function $(e){var o=typeof e;return!!e&&(o=="object"||o=="function")}function Ae(e){return!!e&&typeof e=="object"}function Me(e){return typeof e=="symbol"||Ae(e)&&Le.call(e)==Re}function Y(e){if(typeof e=="number")return e;if(Me(e))return J;if($(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=$(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=e.replace(Ee,"");var u=Ie.test(e);return u||he.test(e)?Be(e.slice(2),u?2:8):Oe.test(e)?J:+e}var Pe=ze;const We=Te(Pe),$e={class:"events__content"},Ge={class:"events__filters"},qe={class:"events__controls"},Z=6e4,Xe=ee({__name:"Events",setup(e){const o=q(()=>[{text:"Event Feed"}]),u=te(),{now:m}=ne({interval:Z});Se("Event Feed");const c=K("resource",[]),f=K("events",[]),i=ae({type:"span",seconds:-ce}),{startDate:a,endDate:r}=se(),{selectionStart:_,selectionEnd:B}=re(),b={minRangeInSeconds:xe-1,maxRangeInSeconds:ke-1},T=oe(()=>{const{startDate:g,endDate:s}=H.map("DateRangeSelectValue",i.range,"DateRange"),[k,v]=de(f.value,I=>I.endsWith("*")),M=k.map(I=>I.replace(".*",".")),l=["prefect.log.write"].filter(I=>!v.includes(I));return{occurred:{since:_.value??g,until:B.value??s},anyResource:{idPrefix:c.value},event:{prefix:M,name:v,excludeName:l}}}),{page:D,pages:R,loading:w,events:E,empty:x}=le(T,{interval:Z}),{margin:C}=ie(),z=()=>({rootMargin:C.value}),{stuck:A}=ue(u,z),O=q(()=>({chart:{"events__chart--stuck":A.value}}));let t=!1;const d=We(()=>{if(!(!a.value||!r.value)){if(t){t=!1;return}i.range={type:"range",startDate:a.value,endDate:r.value}}},1e3);Q([a,r],()=>d());function p(){var k,v;if(!i.range)return;const{startDate:g,endDate:s}=H.map("DateRangeSelectValue",i.range,"DateRange");((k=a.value)==null?void 0:k.getTime())!==g.getTime()&&(t=!0,a.value=g),((v=r.value)==null?void 0:v.getTime())!==s.getTime()&&(t=!0,r.value=s)}return Q(()=>i.range,()=>p()),p(),(g,s)=>{const k=F("p-label"),v=F("p-empty-results"),M=F("p-pager"),G=F("p-layout-default");return n(a)&&n(r)?(h(),V(G,{key:0,class:"events"},{header:S(()=>[y(n(fe),{crumbs:o.value},null,8,["crumbs"])]),default:S(()=>[L("div",$e,[L("div",Ge,[y(k,{label:"Resource"},{default:S(({id:l})=>[y(n(me),{id:l,selected:n(c),"onUpdate:selected":s[0]||(s[0]=N=>j(c)?c.value=N:null),multiple:""},null,8,["id","selected"])]),_:1}),y(k,{label:"Events"},{default:S(({id:l})=>[y(n(pe),{id:l,selected:n(f),"onUpdate:selected":s[1]||(s[1]=N=>j(f)?f.value=N:null),multiple:""},null,8,["id","selected"])]),_:1})]),L("div",{ref_key:"chart",ref:u,class:ge(["events__chart p-background",O.value.chart])},[y(n(ve),{"start-date":n(a),"onUpdate:startDate":s[2]||(s[2]=l=>j(a)?a.value=l:null),"end-date":n(r),"onUpdate:endDate":s[3]||(s[3]=l=>j(r)?r.value=l:null),filter:T.value,"zoom-options":b},null,8,["start-date","end-date","filter"]),L("div",qe,[y(n(ye),{modelValue:n(i).range,"onUpdate:modelValue":s[4]||(s[4]=l=>n(i).range=l),max:n(m)},null,8,["modelValue","max"])])],2),n(w)&&n(x)?(h(),V(v,{key:0},{message:S(()=>[X(" Loading events ")]),_:1})):(h(),_e(De,{key:1},[n(x)?(h(),V(v,{key:0},{message:S(()=>[X(" No events ")]),_:1})):P("",!0),y(n(be),{class:"events__timeline",events:n(E),"start-date":n(a),"end-date":n(r)},null,8,["events","start-date","end-date"]),n(E).length?(h(),V(M,{key:1,page:n(D),"onUpdate:page":s[5]||(s[5]=l=>j(D)?D.value=l:null),pages:n(R),"onUpdate:pages":s[6]||(s[6]=l=>j(R)?R.value=l:null),class:"events__pager"},null,8,["page","pages"])):P("",!0)],64))])]),_:1})):P("",!0)}}});export{Xe as default};
//# sourceMappingURL=Events-mvEpq8Md.js.map
